openapi: 3.0.3
info:
  title: Easyapp API
  version: 1.0.0
  description: API documentation for easyapp
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Message:
      type: object
      properties:
        message:
          type: string
        timestamp:
          type: string
          format: date-time
      required: [message, timestamp]
    MemberPublic:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        phone:
          type: string
        about:
          type: string
        registered_at:
          type: string
          format: date-time
      required: [id, name, phone, about, registered_at]
    MemberPrivate:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        name:
          type: string
        phone:
          type: string
        about:
          type: string
        registered_at:
          type: string
          format: date-time
      required: [id, username, name, phone, about, registered_at]
    TokenResponse:
      type: object
      properties:
        token:
          type: string
        member:
          $ref: '#/components/schemas/MemberPrivate'
      required: [token, member]
    Ad:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        price:
          type: number
          format: float
        contact_phone:
          type: string
        category:
          type: string
          enum: ["Автомобили", "Недвижимость"]
        author:
          $ref: '#/components/schemas/MemberPublic'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, title, description, price, contact_phone, category, author, created_at, updated_at]
paths:
  /api/hello/:
    get:
      tags: [api]
      description: Get a hello world message
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
  /api/auth/register/:
    post:
      tags: [auth]
      description: Register a new member
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
                name:
                  type: string
                phone:
                  type: string
              required: [username, password, name, phone]
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPrivate'
  /api/auth/login/:
    post:
      tags: [auth]
      description: Login and obtain JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
              required: [username, password]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
  /api/profile/me/:
    get:
      tags: [profile]
      security:
        - bearerAuth: []
      description: Get current member profile
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPrivate'
    patch:
      tags: [profile]
      security:
        - bearerAuth: []
      description: Update current member profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MemberPrivate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberPrivate'
  /api/ads/:
    get:
      tags: [ads]
      description: List ads with filters
      parameters:
        - in: query
          name: category
          schema:
            type: string
            enum: ["Автомобили", "Недвижимость"]
        - in: query
          name: price_min
          schema:
            type: number
        - in: query
          name: price_max
          schema:
            type: number
        - in: query
          name: date_from
          schema:
            type: string
            format: date-time
        - in: query
          name: date_to
          schema:
            type: string
            format: date-time
        - in: query
          name: search
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ad'
    post:
      tags: [ads]
      security:
        - bearerAuth: []
      description: Create new ad
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                price:
                  type: number
                contact_phone:
                  type: string
                category:
                  type: string
                  enum: ["Автомобили", "Недвижимость"]
              required: [title, description, price, contact_phone, category]
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ad'
  /api/ads/{id}/:
    get:
      tags: [ads]
      description: Get ad details
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ad'
    patch:
      tags: [ads]
      security:
        - bearerAuth: []
      description: Update ad (owner only)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                price:
                  type: number
                contact_phone:
                  type: string
                category:
                  type: string
                  enum: ["Автомобили", "Недвижимость"]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ad'
    delete:
      tags: [ads]
      security:
        - bearerAuth: []
      description: Delete ad (owner only)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content
